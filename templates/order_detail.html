{% extends 'base.html' %}

{% block title %}Order #{{ order.id }} - CP360{% endblock %}

{% block content %}
<div class="card">
    <h2>Order #{{ order.id }}</h2>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
        <div>
            <h3>Order Information</h3>
            <p><strong>Order ID:</strong> #{{ order.id }}</p>
            <p><strong>Customer:</strong> {{ order.user.email }}</p>
            <p><strong>Status:</strong> {{ order.get_status_display }}</p>
            <p><strong>Created:</strong> {{ order.created_at|date:"M d, Y H:i" }}</p>
            <p><strong>Last Updated:</strong> {{ order.updated_at|date:"M d, Y H:i" }}</p>
        </div>
        
        {% if user.role == 'ADMIN' or user.role == 'STAFF' %}
        <div>
            <h3>Update Status</h3>
            <form method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label for="status">Change Status:</label>
                    <select id="status" name="status">
                        <option value="PENDING" {% if order.status == 'PENDING' %}selected{% endif %}>Pending</option>
                        <option value="SUCCESS" {% if order.status == 'SUCCESS' %}selected{% endif %}>Success</option>
                        <option value="CANCELLED" {% if order.status == 'CANCELLED' %}selected{% endif %}>Cancelled</option>
                    </select>
                </div>
                <button type="submit" class="btn">Update Status</button>
            </form>
        </div>
        {% endif %}
    </div>
    
    <h3>Products in this Order</h3>
    {% if order.products.all %}
        <table class="table">
            <thead>
                <tr>
                    <th>Product ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Product Status</th>
                </tr>
            </thead>
            <tbody>
                {% for product in order.products.all %}
                <tr>
                    <td>{{ product.id }}</td>
                    <td>{{ product.name }}</td>
                    <td>{{ product.description|truncatechars:100 }}</td>
                    <td>{{ product.category.name }}</td>
                    <td>{{ product.get_status_display }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No products in this order.</p>
    {% endif %}
    
    <a href="{% url 'orders' %}" class="btn" style="background: #6c757d;">Back to Orders</a>
</div>
{% endblock %} 